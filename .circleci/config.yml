version: 2.1

jobs:
  build-and-push-docker-image:
    docker:
      - image: cimg/go:1.17
        auth:
          username: nurba1713
          password: nurba1713
    steps:
      - checkout
      - setup_remote_docker:
          version: 20.10.14
          docker_layer_caching: true
      - run: |
          TAG=0.1.$CIRCLE_BUILD_NUM
          cd circleci-example
          docker build -t nurba1713/circleci:$TAG .
          echo nurba1713 | docker login -u nurba1713 --password-stdin
          docker push  nurba1713/circleci:$TAG

  say-hello:
    docker:
      - image: cimg/base:stable
    steps:
      - checkout
      - run:
          name: "Say hello"
          command: "echo Hello, World!"
#  say-hello-without-master:
#    docker:
#      - image: cimg/base:stable
#    steps:
#      - checkout
#      - run:
#          name: "Say hello without master"
#          command: "echo Hello, Hello without dev"
workflows:
  say-hello-workflow:
    jobs:
      - build-and-push-docker-image:
          filters:
            branches:
              only: master
      - say-hello
#  say-nurba:
#    jobs:
#      - say-hello-without-master:
#          filters:
#            branches:
#              ignore: master
